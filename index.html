<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ame Import - E-commerce</title>
    <!-- Carrega o Tailwind CSS para estiliza√ß√£o moderna -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Define a fonte Inter e o tema de cores personalizado -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F8FAFC; /* Fundo suave, quase branco */
        }
        /* Cores Tem√°ticas */
        .text-gold { color: #DFA40A; } /* Amarelo Dourado para destaque */
        .bg-gold { background-color: #DFA40A; } 
        .border-gold { border-color: #DFA40A; }
        .shadow-gold { box-shadow: 0 4px 6px -1px rgba(223, 164, 10, 0.2), 0 2px 4px -2px rgba(223, 164, 10, 0.1); } /* Sombra Dourada */

        .text-dark-blue { color: #1E3A8A; } /* Azul Escuro */
        .bg-dark-blue { background-color: #1E3A8A; }

        /* Estilos para o bot√£o de filtro ativo e abas de navega√ß√£o */
        .nav-link.active, .filter-button.active {
            background-color: #DFA40A;
            color: white; 
            border-color: #DFA40A;
            box-shadow: 0 2px 5px rgba(223, 164, 10, 0.5);
        }
        /* Esconde o menu social quando fechado */
        .social-menu-toggle {
            transition: transform 0.3s ease-in-out;
        }
        /* Esconde a barra de rolagem mas permite o scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Estiliza√ß√£o da Sidebar de Filtros */
        #filter-sidebar {
            transition: transform 0.3s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Overlay de Carregamento (Loading) -->
    <div id="loading-overlay" class="fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-[101]">
        <div class="flex flex-col items-center">
            <div class="animate-spin rounded-full h-12 w-12 border-4 border-gold border-t-transparent"></div>
            <p class="mt-4 text-gold font-semibold">Carregando Ame Import...</p>
        </div>
    </div>

    <!-- Cabe√ßalho Principal e Navega√ß√£o -->
    <header class="bg-white shadow-lg sticky top-0 z-40">
        <div class="max-w-7xl mx-auto p-4 flex justify-between items-center">
            <!-- Nome da Loja -->
            <h1 class="text-3xl font-extrabold text-gold">Ame Import</h1>
            
            <!-- Links de Navega√ß√£o (Desktop) -->
            <nav class="hidden md:flex space-x-4">
                <button onclick="setCategory('Home')" id="nav-Home" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition active">Home</button>
                <button onclick="setCategory('Perfume Feminino')" id="nav-Perfume Feminino" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">P. Fem.</button>
                <button onclick="setCategory('Perfume Masculino')" id="nav-Perfume Masculino" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">P. Masc.</button>
                <button onclick="setCategory('Kit')" id="nav-Kit" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">Kits</button>
                <button onclick="setCategory('Creme')" id="nav-Creme" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">Cremes</button>
                <button onclick="setCategory('Sabonete')" id="nav-Sabonete" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">Sabonetes</button>
                <button onclick="setCategory('Biqu√≠ni')" id="nav-Biqu√≠ni" class="nav-link px-3 py-2 rounded-lg text-gray-700 font-semibold hover:bg-gray-100 transition">Biqu√≠nis</button>
            </nav>

            <!-- √çcones de A√ß√£o -->
            <div class="flex items-center space-x-3 sm:space-x-4">
                 <!-- Bot√£o de Filtro (Lupa) para Mobile -->
                <button onclick="toggleFilterSidebar()" class="md:hidden p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition text-gray-600" title="Abrir Filtros">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </button>

                <!-- Bot√£o do Perfil/Cadastro -->
                <button onclick="openProfileModal()" class="relative p-2 rounded-full bg-gray-100 hover:bg-gray-200 transition text-gray-600" title="Meu Perfil">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                </button>

                <!-- Bot√£o do Carrinho (Fundo Dourado) -->
                <button onclick="document.getElementById('cart-sidebar').classList.toggle('hidden')" class="relative p-2 rounded-full bg-gold hover:bg-dark-blue transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                    <!-- Contagem do carrinho (Fundo Azul Escuro) -->
                    <span id="cart-item-count" class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white transform translate-x-1/2 -translate-y-1/2 bg-dark-blue rounded-full">0</span>
                </button>
            </div>
        </div>
        <!-- Links de Navega√ß√£o (Mobile - Abaixo do header) -->
        <nav class="md:hidden flex justify-start overflow-x-auto whitespace-nowrap p-2 bg-gray-50 border-t border-gray-200 no-scrollbar">
            <button onclick="setCategory('Home')" id="nav-mobile-Home" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition active">Home</button>
            <button onclick="setCategory('Perfume Feminino')" id="nav-mobile-Perfume Feminino" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">P. Fem.</button>
            <button onclick="setCategory('Perfume Masculino')" id="nav-mobile-Perfume Masculino" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">P. Masc.</button>
            <button onclick="setCategory('Kit')" id="nav-mobile-Kit" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">Kits</button>
            <button onclick="setCategory('Creme')" id="nav-mobile-Creme" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">Cremes</button>
            <button onclick="setCategory('Sabonete')" id="nav-mobile-Sabonete" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">Sabonetes</button>
            <button onclick="setCategory('Biqu√≠ni')" id="nav-mobile-Biqu√≠ni" class="nav-link px-3 py-1 mr-2 rounded-full text-sm text-gray-700 hover:bg-gray-200 transition">Biqu√≠nis</button>
        </nav>
        <!-- ID do Usu√°rio para rastreio em mobile -->
        <div class="md:hidden text-center p-2 bg-gray-100 border-t border-gray-200">
            <span id="user-id-display-mobile" class="text-xs text-gray-500 truncate" title="Seu ID de Usu√°rio"></span>
        </div>
    </header>

    <!-- Sidebar de Filtros (Pequena e Vertical) -->
    <aside id="filter-sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-2xl p-6 transform -translate-x-full md:translate-x-0 transition-transform duration-300 md:static md:w-auto md:shadow-none md:p-0 md:bg-transparent">
        <div class="md:sticky md:top-20 md:w-64 bg-white p-6 rounded-xl shadow-md space-y-6">
            
            <div class="flex justify-between items-center md:hidden mb-4">
                <h3 class="text-xl font-bold text-gray-800 border-b-2 border-gold pb-2">Filtros</h3>
                <button onclick="toggleFilterSidebar()" class="text-gray-500 hover:text-gray-800 transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            
            <!-- Busca por Nome -->
            <div class="space-y-2">
                <label for="search-input" class="block text-sm font-medium text-gray-700">Buscar por Nome</label>
                <input type="text" id="search-input" oninput="applyFilters()" placeholder="Ex: Jasmim, Matte, Azul" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-gold focus:border-gold">
            </div>
            
            <!-- Filtro por Pre√ßo -->
            <div class="space-y-3">
                <h4 class="text-lg font-semibold text-gray-800">Pre√ßo (R$)</h4>
                <div class="flex space-x-2">
                    <input type="number" id="min-price" oninput="applyFilters()" placeholder="M√≠nimo" class="w-1/2 p-2 border border-gray-300 rounded-lg text-sm focus:ring-gold focus:border-gold" min="0" value="0">
                    <input type="number" id="max-price" oninput="applyFilters()" placeholder="M√°ximo" class="w-1/2 p-2 border border-gray-300 rounded-lg text-sm focus:ring-gold focus:border-gold" min="0" value="500">
                </div>
            </div>

            <!-- Filtros Espec√≠ficos de Biqu√≠ni (Visibilidade controlada pelo JS) -->
            <div id="bikini-filters" class="space-y-4 hidden">
                <h4 class="text-lg font-semibold text-gold">Filtros Biqu√≠ni</h4>
                <div class="space-y-2">
                    <label for="color-filter" class="block text-sm font-medium text-gray-700">Cor</label>
                    <select id="color-filter" onchange="applyFilters()" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-gold focus:border-gold">
                        <option value="">Todas as Cores</option>
                    </select>
                </div>
                <div class="space-y-2">
                    <label for="size-filter" class="block text-sm font-medium text-gray-700">Tamanho</label>
                    <select id="size-filter" onchange="applyFilters()" class="w-full p-2 border border-gray-300 rounded-lg text-sm focus:ring-gold focus:border-gold">
                        <option value="">Todos os Tamanhos</option>
                    </select>
                </div>
            </div>
            
            <button onclick="clearFilters()" class="w-full border border-gray-300 text-gray-700 font-semibold py-2 rounded-xl hover:bg-gray-100 transition">
                Limpar Filtros
            </button>
        </div>
    </aside>

    <!-- Conte√∫do Principal e Container de Views -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 flex">

        <!-- O container principal √© a √°rea onde a Home e as categorias aparecem -->
        <div id="view-container" class="flex-grow">
            <!-- T√≠tulo Din√¢mico da P√°gina -->
            <h2 id="page-title" class="text-3xl font-bold mb-6 text-gray-800 border-b-2 border-gold pb-2"></h2>
            
            <!-- HOME PAGE (Faixada da Loja) -->
            <div id="view-Home" class="product-view">
                <div class="bg-dark-blue text-white p-8 rounded-xl mb-8 shadow-xl">
                    <h3 class="text-4xl font-extrabold text-gold mb-2">Bem-vindo(a) √† Ame Import!</h3>
                    <p class="text-lg">Sua porta de entrada para perfumes, maquiagens e moda praia de alta qualidade.</p>
                </div>

                <h4 class="text-2xl font-bold text-gray-800 mb-4 border-b border-gray-200 pb-1">üî• Ofertas da Semana</h4>
                <div id="home-promotions" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">
                    <!-- Produtos em promo√ß√£o ser√£o injetados aqui -->
                </div>

                <h4 class="text-2xl font-bold text-gray-800 mb-4 border-b border-gray-200 pb-1">‚ú® Destaques da Cole√ß√£o</h4>
                <div id="home-highlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Produtos em destaque ser√£o injetados aqui -->
                </div>
            </div>

            <!-- VIEW DE CATEGORIAS (Lista de Produtos Filtrada) -->
            <div id="view-Perfume Feminino" class="product-view hidden">
                <div id="product-list-Perfume Feminino" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            <div id="view-Perfume Masculino" class="product-view hidden">
                <div id="product-list-Perfume Masculino" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            <div id="view-Kit" class="product-view hidden">
                <div id="product-list-Kit" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            <div id="view-Creme" class="product-view hidden">
                <div id="product-list-Creme" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            <div id="view-Sabonete" class="product-view hidden">
                <div id="product-list-Sabonete" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            <div id="view-Biqu√≠ni" class="product-view hidden">
                <div id="product-list-Biqu√≠ni" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"></div>
            </div>
            
        </div>
    </main>
    
    <!-- Carrinho (Sidebar Fixa) -->
    <aside id="cart-sidebar" class="fixed inset-y-0 right-0 z-50 w-full max-w-sm bg-white shadow-2xl p-6 transform translate-x-full transition-transform duration-300 hidden">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-gold">Seu Carrinho</h3>
            <!-- Bot√£o de fechar -->
            <button onclick="document.getElementById('cart-sidebar').classList.add('hidden')" class="text-gray-500 hover:text-gray-800 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        
        <div id="cart-items-container" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
            <p id="empty-cart-message" class="text-gray-500 text-center italic">Seu carrinho est√° vazio.</p>
            <!-- Itens do carrinho ser√£o renderizados aqui -->
        </div>

        <div class="mt-6 pt-4 border-t border-gray-200">
            <div class="flex justify-between items-center text-xl font-bold mb-4">
                <span>Total:</span>
                <span id="cart-total" class="text-gold">R$ 0,00</span>
            </div>
            <button id="checkout-button" onclick="openCheckoutModal()" disabled class="w-full bg-gold text-dark-blue font-semibold py-3 rounded-xl shadow-md hover:bg-dark-blue hover:text-white transition disabled:opacity-50">
                Finalizar Compra
            </button>
        </div>
    </aside>

    <!-- Bot√£o de Contato Flutuante -->
    <div class="fixed bottom-6 right-6 z-30">
        <button id="social-toggle-button" onclick="toggleSocialMenu()" class="social-menu-toggle bg-dark-blue text-white p-4 rounded-full shadow-lg hover:bg-dark-blue/90 transition transform hover:scale-110">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.111A9.503 9.503 0 013 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
        </button>

        <div id="social-menu" class="absolute bottom-16 right-0 space-y-2 hidden">
            <!-- Link Instagram: SUBSTITUA ESTE LINK PELO SEU -->
            <a href="https://www.instagram.com/ame_import_oficial" target="_blank" class="block bg-white text-dark-blue p-3 rounded-full shadow-lg hover:bg-gray-100 transition transform hover:scale-105" title="Instagram">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm4.332 2.805A1.696 1.696 0 0116.89 5.61a5.672 5.672 0 01-1.076 3.12 7.086 7.086 0 01-3.743 1.832 7.03 7.03 0 01-4.148-.073A5.73 5.73 0 014.11 5.61a1.696 1.696 0 01.558-.805 1.7 1.7 0 01.815-.49c.27-.083 4.29-.863 5.818-.863s5.548.78 5.818.863a1.7 1.7 0 01.815.49zM12 18c-3.309 0-6-2.691-6-6s2.691-6 6-6 6 2.691 6 6-2.691 6-6 6zm0-10a4 4 0 100 8 4 4 0 000-8z"/></svg>
            </a>
            <!-- Link WhatsApp: SUBSTITUA ESTE N√öMERO PELO SEU -->
            <a href="https://wa.me/5511999999999?text=Ol%C3%A1%2C%20gostaria%20de%20fazer%20um%20pedido%20na%20Ame%20Import." target="_blank" class="block bg-white text-dark-blue p-3 rounded-full shadow-lg hover:bg-gray-100 transition transform hover:scale-105" title="WhatsApp">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.486 2 2 6.486 2 12c0 3.107 1.344 5.925 3.518 7.915L2 22l3.784-1.921A9.957 9.957 0 0012 22c5.514 0 10-4.486 10-10S17.514 2 12 2zm4.84 14.394a.885.885 0 01-.618.334c-.16 0-.323-.038-.475-.113-.758-.372-1.745-.724-2.812-.907-.63-.11-1.16-.142-1.637.135-.114.066-.234.093-.356.093-.16 0-.322-.05-.466-.145-.25-.17-.417-.384-.52-.614a.886.886 0 01-.11-.476c0-.233.104-.45.282-.607.172-.15.353-.25.54-.298.058-.016.12-.02.18-.016.19.014.37.078.53.18.2.124.384.283.542.46.21.238.384.475.52.704.09.155.16.32.2.49.02.08.03.16.03.24 0 .093-.01.18-.03.27-.03.1-.06.2-.1.3-.1.2-.2.38-.33.56-.23.32-.5.58-.8.78-.45.3-.96.53-1.5.65-.24.05-.48.07-.72.07-1.12 0-2.18-.32-3.13-1.02-.27-.2-.49-.43-.68-.68-.67-.88-1.07-1.89-1.1-2.97-.02-.13-.02-.25-.02-.37 0-1.13.4-2.19 1.15-3.08.76-.9 1.8-1.42 2.95-1.42 1.16 0 2.2.53 2.96 1.45.19.23.35.49.49.76.13.25.24.52.3.8.04.16.05.3.05.44 0 .28-.05.55-.16.8-.1.24-.25.46-.42.66-.08.08-.17.15-.26.22-.09.07-.18.13-.28.18-.1.05-.2.09-.3.12-.1.03-.2.05-.3.07-.15.02-.3.03-.45.03-.27 0-.53-.06-.77-.18-.37-.18-.6-.46-.66-.78-.04-.15-.06-.3-.06-.45 0-.25.04-.5.12-.75.08-.23.19-.44.32-.64.12-.17.26-.33.42-.48.2-.18.42-.34.66-.48.24-.13.49-.24.75-.32.27-.09.55-.13.83-.13.56 0 1.05.15 1.5.42.5.3.8.7.9 1.2.04.17.06.33.06.5 0 .54-.2 1.05-.58 1.5-.18.2-.4.36-.63.5a.944.944 0 01-1.35.05 1.042 1.042 0 01-.15-.2c-.1-.13-.2-.27-.28-.42-.09-.16-.14-.33-.16-.5-.02-.2 0-.39.06-.57.06-.18.17-.35.32-.5.09-.08.19-.16.3-.22.1-.06.2-.12.3-.16.1-.04.2-.07.3-.09.1-.02.2-.03.3-.03.1 0 .2.01.3.03.09.02.18.05.27.08.1.04.2.08.28.13.09.06.17.12.25.19.16.14.3.3.43.47.1.13.19.27.27.42.08.15.14.3.18.46.04.16.06.32.06.49 0 .43-.13.84-.36 1.2-.23.36-.55.67-.93.94-.65.48-1.39.75-2.18.8z"/></svg>
            </a>
        </div>
    </div>
    
    <!-- Modal de Mensagem (substitui alert()) -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[102]">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full text-center">
            <h4 id="modal-title" class="text-xl font-bold mb-3 text-gold">Aten√ß√£o</h4>
            <p id="modal-message" class="text-gray-700 mb-4">Mensagem.</p>
            <button onclick="document.getElementById('message-modal').classList.add('hidden'); document.getElementById('message-modal').classList.remove('flex');" class="bg-gold text-dark-blue px-4 py-2 rounded-lg hover:bg-dark-blue hover:text-white transition">
                Fechar
            </button>
        </div>
    </div>

    <!-- Modal de Perfil/Cadastro -->
    <div id="profile-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[102]">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gold mb-6 border-b pb-2">Meu Perfil e Cadastro</h3>
            <form id="profile-form" onsubmit="event.preventDefault(); saveUserProfile(this)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-full">
                        <label for="profile-name" class="block text-sm font-medium text-gray-700">Nome Completo</label>
                        <input type="text" id="profile-name" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="col-span-1">
                        <label for="profile-cpf" class="block text-sm font-medium text-gray-700">CPF</label>
                        <input type="text" id="profile-cpf" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="col-span-1">
                        <label for="profile-phone" class="block text-sm font-medium text-gray-700">Telefone Fixo</label>
                        <input type="tel" id="profile-phone" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="col-span-1">
                        <label for="profile-cell" class="block text-sm font-medium text-gray-700">Celular</label>
                        <input type="tel" id="profile-cell" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="col-span-full">
                        <label for="profile-address" class="block text-sm font-medium text-gray-700">Endere√ßo (Geral)</label>
                        <textarea id="profile-address" rows="2" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg"></textarea>
                    </div>
                </div>
                <div class="flex justify-between items-center mt-6 pt-4 border-t">
                    <button type="button" onclick="openProductAdminModal()" class="text-sm font-semibold text-dark-blue hover:text-gold transition">
                        Gerenciar Produtos (Admin)
                    </button>
                    <div class="flex space-x-3">
                        <button type="button" onclick="document.getElementById('profile-modal').classList.add('hidden'); document.getElementById('profile-modal').classList.remove('flex');" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
                            Cancelar
                        </button>
                        <button type="submit" class="bg-gold text-dark-blue px-4 py-2 rounded-lg hover:bg-dark-blue hover:text-white transition">
                            Salvar Perfil
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Cadastro de Produto (Admin) -->
    <div id="product-admin-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[103]">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-dark-blue mb-6 border-b pb-2">Cadastrar Novo Produto</h3>
            <form id="product-form" onsubmit="event.preventDefault(); addNewProduct(this)">
                <div class="space-y-4">
                    <div>
                        <label for="product-name" class="block text-sm font-medium text-gray-700">Nome do Produto</label>
                        <input type="text" id="product-name" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="product-description" class="block text-sm font-medium text-gray-700">Descri√ß√£o</label>
                        <textarea id="product-description" rows="2" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label for="product-price" class="block text-sm font-medium text-gray-700">Pre√ßo (R$)</label>
                            <input type="number" id="product-price" step="0.01" min="0" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="product-category" class="block text-sm font-medium text-gray-700">Categoria</label>
                            <select id="product-category" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                                <!-- Op√ß√µes de categoria ser√£o preenchidas pelo JS -->
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="product-image" class="block text-sm font-medium text-gray-700">URL da Imagem</label>
                        <input type="url" id="product-image" placeholder="Ex: https://seusite.com/imagem.jpg" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="flex items-center space-x-4">
                        <label for="product-promo" class="flex items-center text-sm font-medium text-gray-700">
                            <input type="checkbox" id="product-promo" class="h-4 w-4 text-gold border-gray-300 rounded focus:ring-gold mr-2">
                            Promo√ß√£o
                        </label>
                         <label for="product-highlight" class="flex items-center text-sm font-medium text-gray-700">
                            <input type="checkbox" id="product-highlight" class="h-4 w-4 text-gold border-gray-300 rounded focus:ring-gold mr-2">
                            Destaque (Home)
                        </label>
                    </div>
                    <!-- Campos Condicionais para Biqu√≠ni -->
                    <div id="admin-bikini-fields" class="grid grid-cols-2 gap-4 hidden border-t pt-4">
                        <div>
                            <label for="admin-color" class="block text-sm font-medium text-gray-700">Cor</label>
                            <input type="text" id="admin-color" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                        <div>
                            <label for="admin-size" class="block text-sm font-medium text-gray-700">Tamanho</label>
                            <input type="text" id="admin-size" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="closeProductAdminModal()" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
                        Voltar
                    </button>
                    <button type="submit" class="bg-dark-blue text-white px-4 py-2 rounded-lg hover:bg-gold hover:text-dark-blue transition">
                        Cadastrar Produto
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal de Checkout e Pagamento -->
    <div id="checkout-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-[102]">
        <div class="bg-white p-8 rounded-xl shadow-2xl max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-2xl font-bold text-gold mb-6 border-b pb-2">Finalizar Pedido</h3>
            <div id="checkout-summary" class="bg-gray-100 p-4 rounded-lg mb-6 text-sm">
                <!-- Resumo do carrinho ser√° injetado aqui -->
            </div>
            
            <form id="checkout-form" onsubmit="event.preventDefault(); submitOrder(this)">
                <h4 class="text-xl font-semibold mb-4">Dados de Entrega</h4>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                    <div>
                        <label for="checkout-cep" class="block text-sm font-medium text-gray-700">CEP</label>
                        <input type="text" id="checkout-cep" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div class="sm:col-span-2">
                        <label for="checkout-address" class="block text-sm font-medium text-gray-700">Rua/Avenida</label>
                        <input type="text" id="checkout-address" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="checkout-number" class="block text-sm font-medium text-gray-700">N√∫mero</label>
                        <input type="text" id="checkout-number" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="checkout-neighborhood" class="block text-sm font-medium text-gray-700">Bairro</label>
                        <input type="text" id="checkout-neighborhood" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="checkout-reference" class="block text-sm font-medium text-gray-700">Ponto de Refer√™ncia</label>
                        <input type="text" id="checkout-reference" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="checkout-city" class="block text-sm font-medium text-gray-700">Cidade</label>
                        <input type="text" id="checkout-city" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    <div>
                        <label for="checkout-state" class="block text-sm font-medium text-gray-700">Estado</label>
                        <input type="text" id="checkout-state" required class="mt-1 block w-full p-2 border border-gray-300 rounded-lg">
                    </div>
                    
                    <div class="sm:col-span-3">
                        <h4 class="text-xl font-semibold mt-6 mb-4 border-t pt-4">M√©todo de Pagamento</h4>
                        <div class="bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-lg" role="alert">
                            <p class="font-bold">Aviso:</p>
                            <p>Simula√ß√£o: O pagamento √© apenas uma etapa de confirma√ß√£o neste modelo.</p>
                            <div class="mt-2 flex items-center">
                                <input type="checkbox" id="payment-accept" required class="h-4 w-4 text-gold border-gray-300 rounded focus:ring-gold mr-2">
                                <label for="payment-accept" class="text-sm">Confirmo os dados acima e desejo finalizar o pedido.</label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6">
                    <button type="button" onclick="document.getElementById('checkout-modal').classList.add('hidden'); document.getElementById('checkout-modal').classList.remove('flex');" class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
                        Voltar
                    </button>
                    <button type="submit" id="submit-order-button" class="bg-gold text-dark-blue px-4 py-2 rounded-lg hover:bg-dark-blue hover:text-white transition">
                        Confirmar Pedido (Total: R$ 0,00)
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts do Firebase e L√≥gica da Aplica√ß√£o -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, collection, onSnapshot, setDoc, deleteDoc, runTransaction, getDoc, addDoc, writeBatch, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";

        // Vari√°veis de Estado
        let isSocialMenuOpen = false;
        let isFilterSidebarOpen = false;
        let db;
        let auth;
        let userId = null;
        let isAuthReady = false;
        let activeCategory = 'Home'; 
        let currentCartItems = []; 
        let allProducts = []; // Novo: Armazena produtos carregados do Firestore
        let cartTotal = 0; 
        let userProfileData = null; 
        
        // Categorias permitidas (para Admin)
        const AVAILABLE_CATEGORIES = ['Perfume Feminino', 'Perfume Masculino', 'Kit', 'Creme', 'Sabonete', 'Biqu√≠ni'];

        // Estado para os filtros de busca e pre√ßo
        let filterState = {
            searchText: '',
            minPrice: 0,
            maxPrice: 500, 
            color: '',
            size: ''
        };

        // --- Configura√ß√µes e Vari√°veis Globais (Fornecidas pelo ambiente) ---
// --- Configura√ß√µes do Firebase (AGORA CONFIGURADAS MANUALMENTE) ---
// Suas chaves de configura√ß√£o do projeto "ame-import":
const REAL_FIREBASE_CONFIG = {
    apiKey: "AIzaSyBc23pCVw7A6Kbw0C6egJ2WN7aMabSPZv8",
    authDomain: "ame-import.firebaseapp.com",
    projectId: "ame-import",
    storageBucket: "ame-import.firebasestorage.app",
    messagingSenderId: "977194836818",
    appId: "1:977194836818:web:82ba955a91533236e0d08b",
    measurementId: "G-BBMYX2E1B8"
};

const appId = REAL_FIREBASE_CONFIG.projectId;
const firebaseConfig = REAL_FIREBASE_CONFIG;
const initialAuthToken = null; // N√£o necess√°rio para hospedagem normal
// -----------------------------------------------------------------
        // Configura√ß√µes para Biqu√≠ni (usadas apenas nos filtros)
        const BIQUINI_COLORS = ['Preto', 'Azul Marinho', 'Vermelho', 'Verde Militar', 'Amarelo Lim√£o', 'Estampa Tropical', 'Rosa Neon'];
        const BIQUINI_SIZES = ['P', 'M', 'G', 'GG'];


        // --- Fun√ß√µes de UI Auxiliares ---

        function showMessage(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            document.getElementById('message-modal').classList.remove('hidden');
            document.getElementById('message-modal').classList.add('flex');
        }

        const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });


        // --- L√≥gica de Admin de Produtos (Firestore) ---

        /**
         * Abre o modal de administra√ß√£o de produtos e preenche as categorias.
         */
        window.openProductAdminModal = () => {
            if (!isAuthReady) {
                 showMessage("Aguarde", "Aguardando conex√£o com o servidor...");
                 return;
            }
            
            // Preenche as categorias no formul√°rio
            const select = document.getElementById('product-category');
            select.innerHTML = AVAILABLE_CATEGORIES.map(cat => `<option value="${cat}">${cat}</option>`).join('');

            // Adiciona listener para mostrar campos de biqu√≠ni se a categoria for 'Biqu√≠ni'
            select.onchange = () => {
                const fields = document.getElementById('admin-bikini-fields');
                if (select.value === 'Biqu√≠ni') {
                    fields.classList.remove('hidden');
                } else {
                    fields.classList.add('hidden');
                }
            };
            
            document.getElementById('profile-modal').classList.add('hidden');
            document.getElementById('product-admin-modal').classList.remove('hidden');
            document.getElementById('product-admin-modal').classList.add('flex');
        };

        window.closeProductAdminModal = () => {
            document.getElementById('product-admin-modal').classList.add('hidden');
            document.getElementById('product-admin-modal').classList.remove('flex');
            document.getElementById('profile-modal').classList.remove('hidden'); // Volta para o modal de perfil
        };

        /**
         * Adiciona um novo produto √† cole√ß√£o 'products' no Firestore.
         */
        window.addNewProduct = async (form) => {
            if (!db) return;

            const category = form.elements['product-category'].value;
            const newProduct = {
                id: Date.now(), // ID simples e √∫nico
                name: form.elements['product-name'].value,
                description: form.elements['product-description'].value,
                price: parseFloat(form.elements['product-price'].value),
                image: form.elements['product-image'].value,
                category: category,
                isPromotion: form.elements['product-promo'].checked || false,
                isHighlight: form.elements['product-highlight'].checked || false,
                createdAt: new Date().toISOString()
            };

            // Adiciona campos espec√≠ficos para Biqu√≠ni
            if (category === 'Biqu√≠ni') {
                newProduct.color = form.elements['admin-color'].value || '√önica';
                newProduct.size = form.elements['admin-size'].value || '√önico';
            }
            
            try {
                // Salva na cole√ß√£o p√∫blica para que todos os usu√°rios possam ver
                const productRef = doc(db, `artifacts/${appId}/public/data/products`, newProduct.id.toString());
                await setDoc(productRef, newProduct);

                showMessage("Sucesso!", `Produto "${newProduct.name}" cadastrado e vis√≠vel na loja.`);
                form.reset();
                closeProductAdminModal();
            } catch (error) {
                console.error("Erro ao cadastrar produto:", error);
                showMessage("Erro de Cadastro", "N√£o foi poss√≠vel cadastrar o produto. Verifique o console.");
            }
        };

        /**
         * Inicializa o listener para carregar a lista de produtos do Firestore.
         */
        function loadProducts() {
            if (!db) return;

            // Define a refer√™ncia da cole√ß√£o p√∫blica de produtos
            const productsColRef = collection(db, `artifacts/${appId}/public/data/products`);
            
            // O query() sem orderBy garante que n√£o precisamos de √≠ndices complexos.
            const q = query(productsColRef); 

            onSnapshot(q, (snapshot) => {
                allProducts = snapshot.docs.map(doc => ({
                    ...doc.data(),
                    id: parseInt(doc.id) // Garante que o ID √© um n√∫mero
                }));
                console.log(`[Firestore] Produtos carregados: ${allProducts.length}`);
                
                // Renderiza a view atual com os novos produtos
                if (activeCategory === 'Home') {
                    renderHomeContent();
                } else {
                    renderProducts(activeCategory);
                }
            }, (error) => {
                console.error("Erro ao carregar produtos:", error);
                showMessage("Erro de Sincroniza√ß√£o", "Ocorreu um erro ao carregar os produtos. Recarregue a p√°gina.");
            });
        }
        
        // --- L√≥gica de Perfil (Firestore) ---
        
        const getProfileDocRef = () => {
            if (!db || !userId) return null;
            return doc(db, `artifacts/${appId}/users/${userId}/profile/main`);
        };

        async function loadUserProfile() {
            const profileRef = getProfileDocRef();
            if (!profileRef) return;
             try {
                const docSnap = await getDoc(profileRef);
                userProfileData = docSnap.exists() ? docSnap.data() : null;
            } catch (error) {
                console.error("Erro ao carregar dados do perfil:", error);
                userProfileData = null;
            }

            const form = document.getElementById('profile-form');
            if (userProfileData) {
                form.elements['profile-name'].value = userProfileData.name || '';
                form.elements['profile-cpf'].value = userProfileData.cpf || '';
                form.elements['profile-phone'].value = userProfileData.phone || '';
                form.elements['profile-cell'].value = userProfileData.cell || '';
                form.elements['profile-address'].value = userProfileData.address || '';
            } else {
                form.reset();
            }
        }

        async function saveUserProfile(form) {
            const profileRef = getProfileDocRef();
            if (!profileRef) {
                showMessage("Erro de Perfil", "Usu√°rio n√£o autenticado. N√£o foi poss√≠vel salvar o perfil.");
                return;
            }

            const profileData = {
                name: form.elements['profile-name'].value,
                cpf: form.elements['profile-cpf'].value,
                phone: form.elements['profile-phone'].value,
                cell: form.elements['profile-cell'].value,
                address: form.elements['profile-address'].value,
                updatedAt: new Date().toISOString()
            };

            try {
                await setDoc(profileRef, profileData, { merge: true });
                userProfileData = profileData; // Atualiza o estado local
                document.getElementById('profile-modal').classList.add('hidden');
                document.getElementById('profile-modal').classList.remove('flex');
                showMessage("Sucesso", "Seu perfil foi salvo com sucesso!");
            } catch (error) {
                console.error("Erro ao salvar perfil:", error);
                showMessage("Erro", "N√£o foi poss√≠vel salvar o perfil. Tente novamente.");
            }
        }

        window.openProfileModal = () => {
            if (!isAuthReady) {
                 showMessage("Aguarde", "Aguardando conex√£o com o servidor...");
                 return;
            }
            loadUserProfile();
            document.getElementById('profile-modal').classList.remove('hidden');
            document.getElementById('profile-modal').classList.add('flex');
        }


        // --- L√≥gica de Checkout ---
        
        window.openCheckoutModal = async () => {
            if (!isAuthReady) {
                 showMessage("Aguarde", "Aguardando conex√£o com o servidor...");
                 return;
            }

            if (currentCartItems.length === 0) {
                showMessage("Carrinho Vazio", "Adicione produtos ao carrinho antes de finalizar a compra!");
                return;
            }
            
            // 1. Renderiza o Resumo do Carrinho
            const summaryElement = document.getElementById('checkout-summary');
            const totalElement = document.getElementById('submit-order-button');
            summaryElement.innerHTML = `
                <p class="font-bold text-lg mb-2">Resumo do Pedido (${currentCartItems.length} itens):</p>
                ${currentCartItems.map(item => `
                    <p class="text-sm">${item.quantity}x ${item.name} (${formatCurrency(item.price)})</p>
                `).join('')}
                <p class="font-extrabold text-lg mt-3 text-gold">Total: ${formatCurrency(cartTotal)}</p>
            `;
            totalElement.textContent = `Confirmar Pedido (Total: ${formatCurrency(cartTotal)})`;

            // 2. Pr√©-preenchimento de Endere√ßo
            await loadUserProfile(); // Garante os dados mais recentes
            const form = document.getElementById('checkout-form');
            if (userProfileData && userProfileData.address) {
                // Implementa√ß√£o simples de pr√©-preenchimento
                form.elements['checkout-address'].value = userProfileData.address.split(',')[0] || '';
                form.elements['checkout-cep'].value = '00000-000'; 
                form.elements['checkout-number'].value = 'S/N';
                form.elements['checkout-neighborhood'].value = 'Centro';
                form.elements['checkout-city'].value = 'S√£o Paulo';
                form.elements['checkout-state'].value = 'SP';
                form.elements['checkout-reference'].value = ''; 
            } else {
                form.reset();
            }

            document.getElementById('cart-sidebar').classList.add('hidden'); // Fecha o carrinho
            document.getElementById('checkout-modal').classList.remove('hidden');
            document.getElementById('checkout-modal').classList.add('flex');
        };

        window.submitOrder = async (form) => {
            if (currentCartItems.length === 0 || !db || !userId) {
                showMessage("Erro", "Carrinho vazio ou erro de autentica√ß√£o.");
                return;
            }

            const orderData = {
                userId: userId,
                items: currentCartItems.map(item => ({
                    productId: item.productId,
                    name: item.name,
                    price: item.price,
                    quantity: item.quantity
                })),
                total: cartTotal,
                delivery: {
                    cep: form.elements['checkout-cep'].value,
                    address: form.elements['checkout-address'].value,
                    number: form.elements['checkout-number'].value,
                    neighborhood: form.elements['checkout-neighborhood'].value,
                    city: form.elements['checkout-city'].value,
                    state: form.elements['checkout-state'].value,
                    reference: form.elements['checkout-reference'].value || 'N/A'
                },
                status: 'Pending Payment Simulation',
                orderDate: new Date().toISOString()
            };

            const cartColRef = collection(db, getCartCollectionPath());
            // Salva o pedido na cole√ß√£o de orders (privada do usu√°rio)
            const ordersColRef = collection(db, `artifacts/${appId}/users/${userId}/orders`); 
            
            try {
                await addDoc(ordersColRef, orderData);

                // Esvazia o carrinho usando batch
                const batch = writeBatch(db);
                currentCartItems.forEach(item => {
                    batch.delete(doc(cartColRef, item.id));
                });
                await batch.commit();

                document.getElementById('checkout-modal').classList.add('hidden');
                document.getElementById('checkout-modal').classList.remove('flex');
                showMessage("Pedido Finalizado!", `Seu pedido de ${formatCurrency(cartTotal)} foi simulado e registrado! Seu carrinho est√° vazio.`);

            } catch (error) {
                console.error("Erro ao finalizar o pedido:", error);
                showMessage("Erro de Pedido", "N√£o foi poss√≠vel finalizar o pedido. Tente novamente.");
            }
        };


        // --- L√≥gica de Navega√ß√£o e Filtros ---

        /**
         * Alterna a visibilidade da sidebar de filtros (usada no mobile).
         */
        window.toggleFilterSidebar = () => {
            const sidebar = document.getElementById('filter-sidebar');
            isFilterSidebarOpen = !isFilterSidebarOpen;
            if (isFilterSidebarOpen) {
                sidebar.classList.remove('-translate-x-full');
            } else {
                sidebar.classList.add('-translate-x-full');
            }
        };

        window.setCategory = (category) => {
            activeCategory = category;
            
            // 1. Atualiza o estado dos links de navega√ß√£o
            document.querySelectorAll('.nav-link').forEach(btn => {
                btn.classList.remove('active');
            });
            // Ativa links de desktop e mobile
            document.getElementById(`nav-${category}`)?.classList.add('active');
            document.getElementById(`nav-mobile-${category}`)?.classList.add('active');

            // 2. Alterna a visibilidade das views
            document.querySelectorAll('.product-view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(`view-${category}`).classList.remove('hidden');
            
            // 3. Atualiza o t√≠tulo
            document.getElementById('page-title').textContent = category === 'Home' ? 'Faixada e Destaques' : `Produtos: ${category}`;

            // 4. Aplica filtros para a nova categoria (limpa filtros se mudar de categoria, exceto Home)
            if (category !== 'Home') {
                applyFilters();
            } else {
                renderHomeContent();
            }
            
            // 5. Fecha o sidebar de filtros se estiver no mobile
            if (isFilterSidebarOpen) {
                toggleFilterSidebar();
            }
        };

        window.applyFilters = () => {
            filterState.searchText = document.getElementById('search-input').value.toLowerCase().trim();
            filterState.minPrice = parseFloat(document.getElementById('min-price').value) || 0;
            filterState.maxPrice = parseFloat(document.getElementById('max-price').value) || 999999;
            filterState.color = document.getElementById('color-filter').value;
            filterState.size = document.getElementById('size-filter').value;

            const bikiniFiltersPanel = document.getElementById('bikini-filters');
            if (activeCategory === 'Biqu√≠ni') {
                bikiniFiltersPanel.classList.remove('hidden');
            } else {
                bikiniFiltersPanel.classList.add('hidden');
                // Garante que filtros de cor/tamanho n√£o se apliquem a outras categorias
                filterState.color = '';
                filterState.size = '';
            }

            // A Home n√£o usa o sistema de lista de produtos e filtros.
            if (activeCategory !== 'Home') {
                renderProducts(activeCategory);
            }
        }

        window.clearFilters = () => {
            document.getElementById('search-input').value = '';
            document.getElementById('min-price').value = 0;
            document.getElementById('max-price').value = 500; 
            document.getElementById('color-filter').value = '';
            document.getElementById('size-filter').value = '';
            
            applyFilters(); 
        }

        // --- L√≥gica do Carrinho (Firestore) ---
        
        const getCartCollectionPath = () => {
            return `artifacts/${appId}/users/${userId}/shopping_cart`;
        };

        async function addToCart(product) {
            if (!db || !userId) return;
            const itemDocRef = doc(db, getCartCollectionPath(), product.id.toString());
            try {
                await runTransaction(db, async (transaction) => {
                    const itemDoc = await transaction.get(itemDocRef);
                    if (itemDoc.exists()) {
                        const newQuantity = itemDoc.data().quantity + 1;
                        transaction.update(itemDocRef, { quantity: newQuantity });
                        // Mensagem de sucesso ser√° disparada pelo listener do onSnapshot
                    } else {
                        transaction.set(itemDocRef, {
                            id: product.id,
                            productId: product.id,
                            name: product.name,
                            price: product.price,
                            quantity: 1,
                            createdAt: new Date().toISOString()
                        });
                        // Mensagem de sucesso ser√° disparada pelo listener do onSnapshot
                    }
                });
            } catch (error) {
                console.error("Erro ao adicionar/atualizar item no carrinho:", error);
                showMessage("Erro", "N√£o foi poss√≠vel adicionar o item ao carrinho. Tente novamente.");
            }
        }

        async function updateQuantity(docId, newQuantity) {
            if (!db || !userId) return;
            const quantity = parseInt(newQuantity, 10);
            if (quantity <= 0) {
                await removeItem(docId);
                return;
            }
            const itemDocRef = doc(db, getCartCollectionPath(), docId);
            try {
                await setDoc(itemDocRef, { quantity: quantity }, { merge: true });
            } catch (error) {
                console.error("Erro ao atualizar a quantidade:", error);
                showMessage("Erro", "N√£o foi poss√≠vel atualizar a quantidade. Tente novamente.");
            }
        }

        async function removeItem(docId) {
            if (!db || !userId) return;
            const itemDocRef = doc(db, getCartCollectionPath(), docId);
            try {
                await deleteDoc(itemDocRef);
            } catch (error) {
                console.error("Erro ao remover item:", error);
                showMessage("Erro", "N√£o foi poss√≠vel remover o item. Tente novamente.");
            }
        }


        // --- Fun√ß√µes de Renderiza√ß√£o de UI ---

        function renderBikiniFilters() {
            const colorSelect = document.getElementById('color-filter');
            const sizeSelect = document.getElementById('size-filter');

            // Limpa e preenche Cor
            colorSelect.innerHTML = '<option value="">Todas as Cores</option>';
            BIQUINI_COLORS.forEach(color => {
                colorSelect.innerHTML += `<option value="${color}" ${filterState.color === color ? 'selected' : ''}>${color}</option>`;
            });

            // Limpa e preenche Tamanho
            sizeSelect.innerHTML = '<option value="">Todos os Tamanhos</option>';
            BIQUINI_SIZES.forEach(size => {
                sizeSelect.innerHTML += `<option value="${size}" ${filterState.size === size ? 'selected' : ''}>${size}</option>`;
            });
        }
        
        function renderHomeContent() {
            const promotionsContainer = document.getElementById('home-promotions');
            const highlightsContainer = document.getElementById('home-highlights');
            
            // Filtra produtos do Firestore para promo√ß√µes e destaques
            const promoProducts = allProducts.filter(p => p.isPromotion).slice(0, 3);
            const highlightProducts = allProducts.filter(p => p.isHighlight).slice(0, 3);
            
            const renderProductCard = (product) => `
                <div class="bg-white rounded-xl p-4 shadow-md hover:shadow-gold transition duration-300 flex flex-col">
                    <img src="${product.image}" alt="${product.name}" class="w-24 h-24 mx-auto rounded-lg mb-4 object-cover border border-gray-100" onerror="this.onerror=null; this.src='https://placehold.co/100x100/A0A0A0/FFFFFF?text=IMG'">
                    <span class="text-xs font-semibold text-gray-500 mb-1">${product.category}</span>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${product.name}</h3>
                    <p class="text-sm text-gray-600 mb-3 flex-grow">${product.description}</p>
                    <div class="mt-auto pt-3 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-2xl font-extrabold text-gold">${formatCurrency(product.price)}</span>
                        <button onclick="addToCartFunc(${product.id})" class="bg-gold text-dark-blue px-4 py-2 rounded-lg font-semibold text-sm hover:bg-dark-blue hover:text-white transition transform hover:scale-105">
                            Adicionar
                        </button>
                    </div>
                </div>
            `;

            promotionsContainer.innerHTML = promoProducts.length > 0 ? promoProducts.map(renderProductCard).join('') : '<p class="col-span-full text-gray-500">Nenhuma promo√ß√£o cadastrada. Cadastre produtos como Admin!</p>';
            highlightsContainer.innerHTML = highlightProducts.length > 0 ? highlightProducts.map(renderProductCard).join('') : '<p class="col-span-full text-gray-500">Nenhum destaque cadastrado. Cadastre produtos como Admin!</p>';
        }


        function renderProducts(category) {
            const container = document.getElementById(`product-list-${category}`);
            if (!container) return;
            
            let filteredProducts = allProducts.filter(p => p.category === category);
            
            const searchText = filterState.searchText;
            if (searchText) {
                filteredProducts = filteredProducts.filter(p => p.name.toLowerCase().includes(searchText) || p.description.toLowerCase().includes(searchText));
            }

            const minPrice = filterState.minPrice;
            const maxPrice = filterState.maxPrice;
            filteredProducts = filteredProducts.filter(p => p.price >= minPrice && p.price <= maxPrice);

            if (category === 'Biqu√≠ni') {
                renderBikiniFilters();
                if (filterState.color) {
                    filteredProducts = filteredProducts.filter(p => p.color === filterState.color);
                }
                if (filterState.size) {
                    filteredProducts = filteredProducts.filter(p => p.size === filterState.size);
                }
            }


            if (filteredProducts.length === 0) {
                container.innerHTML = `<p class="text-center text-lg text-gray-500 italic py-10 w-full col-span-full">Nenhum produto encontrado na categoria ${category} com os filtros atuais.</p>`;
                return;
            }

            container.innerHTML = filteredProducts.map(product => `
                <div class="bg-white rounded-xl p-4 shadow-md hover:shadow-gold transition duration-300 flex flex-col">
                    <img src="${product.image}" alt="${product.name}" class="w-24 h-24 mx-auto rounded-lg mb-4 object-cover border border-gray-100" onerror="this.onerror=null; this.src='https://placehold.co/100x100/A0A0A0/FFFFFF?text=IMG'">
                    <span class="text-xs font-semibold text-gray-500 mb-1">${product.category}</span>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">${product.name}</h3>
                    <p class="text-sm text-gray-600 mb-3 flex-grow">${product.description}</p>
                    ${product.color ? `<p class="text-xs font-medium text-gray-700">Cor: ${product.color} | Tam: ${product.size}</p>` : ''}
                    <div class="mt-auto pt-3 border-t border-gray-100 flex justify-between items-center">
                        <span class="text-2xl font-extrabold text-gold">${formatCurrency(product.price)}</span>
                        <button onclick="addToCartFunc(${product.id})" class="bg-gold text-dark-blue px-4 py-2 rounded-lg font-semibold text-sm hover:bg-dark-blue hover:text-white transition transform hover:scale-105">
                            Adicionar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function renderCart(cartItems) {
            currentCartItems = cartItems; 
            const container = document.getElementById('cart-items-container');
            const totalElement = document.getElementById('cart-total');
            const countElement = document.getElementById('cart-item-count');
            const emptyMessage = document.getElementById('empty-cart-message');
            const checkoutButton = document.getElementById('checkout-button');

            if (cartItems.length === 0) {
                container.innerHTML = '';
                emptyMessage.classList.remove('hidden');
                totalElement.textContent = formatCurrency(0);
                countElement.textContent = '0';
                checkoutButton.disabled = true;
                cartTotal = 0;
                return;
            }

            emptyMessage.classList.add('hidden');
            let total = 0;

            const cartHtml = cartItems.map(item => {
                const productData = allProducts.find(p => p.id === item.productId);
                const currentPrice = productData ? productData.price : item.price;
                
                const subtotal = currentPrice * item.quantity;
                total += subtotal;

                return `
                    <div class="flex items-center space-x-4 p-3 bg-white border border-gray-100 rounded-lg shadow-sm">
                        <img src="${productData ? productData.image : 'https://placehold.co/50x50/DFA40A/FFFFFF?text=I'}" alt="${item.name}" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-grow">
                            <h4 class="font-semibold text-gray-800 text-sm">${item.name}</h4>
                            <span class="text-xs text-gray-500">${formatCurrency(currentPrice)} cada</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input
                                type="number"
                                min="1"
                                value="${item.quantity}"
                                onchange="updateQuantity('${item.id}', this.value)"
                                class="w-12 text-center border rounded-md p-1 text-sm focus:border-gold focus:ring-gold"
                            >
                            <button onclick="removeItem('${item.id}')" class="text-red-500 hover:text-red-700 transition p-1 rounded-full">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = cartHtml;
            totalElement.textContent = formatCurrency(total);
            countElement.textContent = cartItems.reduce((sum, item) => sum + item.quantity, 0).toString();
            checkoutButton.disabled = false;
            cartTotal = total;
        }

        /**
         * Inicializa o listener de tempo real do carrinho do Firestore.
         */
        function loadCart() {
            if (!db || !userId) return;

            const cartColRef = collection(db, getCartCollectionPath());

            onSnapshot(cartColRef, (snapshot) => {
                const cartItems = snapshot.docs.map(doc => {
                    const data = doc.data();
                    const productData = allProducts.find(p => p.id === data.productId);
                    return {
                        ...data,
                        id: doc.id, 
                        price: productData ? productData.price : data.price, 
                        name: productData ? productData.name : data.name 
                    };
                });
                renderCart(cartItems);
            }, (error) => {
                console.error("Erro ao carregar o carrinho:", error);
                // N√£o mostra erro para o usu√°rio final, apenas no console
            });
        }

        // --- Mapeamento de Fun√ß√µes Globais e Outras Utilit√°rias ---

        window.addToCartFunc = (productId) => {
            const product = allProducts.find(p => p.id === productId);
            if (product) {
                addToCart(product);
            }
        };

        window.toggleSocialMenu = () => {
            const menu = document.getElementById('social-menu');
            const button = document.getElementById('social-toggle-button');
            isSocialMenuOpen = !isSocialMenuOpen;
            
            if (isSocialMenuOpen) {
                menu.classList.remove('hidden');
                menu.classList.add('flex', 'flex-col-reverse'); 
                button.classList.add('transform', 'rotate-45'); 
            } else {
                menu.classList.add('hidden');
                menu.classList.remove('flex', 'flex-col-reverse');
                button.classList.remove('transform', 'rotate-45');
            }
        };


        // --- Inicializa√ß√£o do Firebase e Autentica√ß√£o ---

// Fun√ß√£o auxiliar para for√ßar o display ap√≥s um timeout
function forceDisplay() {
    console.warn("TIMEOUT: Firebase demorou para conectar. Exibindo UI agora.");
    document.getElementById('loading-overlay').classList.add('hidden');
    // Chama display mesmo que o isAuthReady ainda seja falso.
    initializeDisplay(); 
}

// --- Inicializa√ß√£o do Firebase e Autentica√ß√£o (REVISADO COM TIMEOUT) ---
async function initializeAppAndAuth() {
    setLogLevel('debug'); // Use 'debug' para ver logs no console
    
    // 1. Verificar configura√ß√£o
    if (!firebaseConfig) {
        console.error("Erro de configura√ß√£o", "As configura√ß√µes do Firebase est√£o ausentes. O carrinho e perfil n√£o ser√£o persistentes.");
        document.getElementById('loading-overlay').classList.add('hidden');
        initializeDisplay();
        return;
    }

    try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);
        
        // 2. Carregamos os produtos do firestore
        // Esta √© a Promise que estava demorando/travando:
        loadProducts(); 

        let authPromise;
        if (initialAuthToken) {
            authPromise = signInWithCustomToken(auth, initialAuthToken);
        } else {
            authPromise = signInAnonymously(auth);
        }

        await authPromise; // Espera a autentica√ß√£o

        // 3. Configura o listener de autentica√ß√£o
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Configura o ID do usu√°rio autenticado
                userId = user.uid;
                isAuthReady = true;
            } else {
                // Configura o ID para fallback an√¥nimo
                userId = crypto.randomUUID();
                isAuthReady = true;
            }
            
            // 4. Inicializa o display AP√ìS a autentica√ß√£o
            initializeDisplay();
        });

    } catch (error) {
        console.error("Erro fatal na inicializa√ß√£o do Firebase:", error);
        showMessage("Erro ao conectar com a loja. Tente recarregar a p√°gina.", 'error');
        // Se houver erro, garantimos que o overlay suma
        document.getElementById('loading-overlay').classList.add('hidden');
    }
}

// O PROMISE.RACE √â A SOLU√á√ÉO FINAL:
// Ele executa a inicializa√ß√£o do Firebase E um timer de 3 segundos.
// Quem terminar primeiro ganha, garantindo que o carregamento n√£o seja eterno.

const timeout = new Promise(resolve => setTimeout(() => {
    forceDisplay();
    resolve('timeout');
}, 3000)); // 3 segundos de timeout

Promise.race([initializeAppAndAuth(), timeout]).catch(error => {
    console.error("Erro durante a corrida de inicializa√ß√£o:", error);
    forceDisplay();
});

// REMOVIDA: A chamada initializeAppAndAuth() original

                await authPromise; 

                onAuthStateChanged(auth, (user) => {
                    let displayId;
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        displayId = `ID: ${userId.substring(0, 8)}...`;
                    } else {
                        // Isso √© um fallback caso a autentica√ß√£o falhe ou seja an√¥nima
                        userId = crypto.randomUUID(); 
                        isAuthReady = false;
                        displayId = `ID An√¥nimo: ${userId.substring(0, 8)}...`;
                    }
                    
                    // CORRE√á√ÉO: Verifica se os elementos existem antes de acessar textContent
                    document.getElementById('user-id-display')?.textContent = displayId;
                    document.getElementById('user-id-display-mobile')?.textContent = displayId;
                    
                    if (isAuthReady) {
                        loadCart(); 
                        loadUserProfile(); 
                    }

                    document.getElementById('loading-overlay').classList.add('hidden');
                });

            } catch (error) {
                console.error("Erro fatal na inicializa√ß√£o do Firebase:", error);
                showMessage("Erro Fatal", "Ocorreu um erro ao conectar ao servi√ßo. Verifique o console.");
                document.getElementById('loading-overlay').classList.add('hidden');
            }
        }

        // --- Inicializa√ß√£o da Aplica√ß√£o ---
        
        initializeAppAndAuth();
        setCategory('Home');
    </script>
</body>
</html>